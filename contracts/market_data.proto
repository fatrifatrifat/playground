syntax = "proto3";

package club.trading.v1;

import "common.proto";

option cc_enable_arenas = true;

enum AggressorSide {
  AGGRESSOR_UNSPECIFIED = 0;
  AGGRESSOR_BUY = 1;
  AGGRESSOR_SELL = 2;
}

enum DeltaAction {
  DELTA_UNSPECIFIED = 0;
  DELTA_ADD = 1;
  DELTA_UPDATE = 2;
  DELTA_REMOVE = 3;
}

message TopOfBook {
  EventMeta meta = 1;
  InstrumentRef instrument = 2;
  int64 bid_px_e8 = 3;
  int64 bid_qty_e8 = 4;
  int64 ask_px_e8 = 5;
  int64 ask_qty_e8 = 6;
}

message TradePrint {
  EventMeta meta = 1;
  InstrumentRef instrument = 2;
  int64 px_e8 = 3;
  int64 qty_e8 = 4;
  AggressorSide aggressor = 5;
  string venue_trade_id = 6;
}

message Bar {
  EventMeta meta = 1;
  InstrumentRef instrument = 2;
  string timeframe = 3;  // e.g. "1m", "5m", "1h"
  int64 open_e8 = 4;
  int64 high_e8 = 5;
  int64 low_e8 = 6;
  int64 close_e8 = 7;
  int64 volume_e8 = 8;
  int64 ts_start_ns = 9;
  int64 ts_end_ns = 10;
}

message BookLevel {
  uint32 level = 1;
  int64 bid_px_e8 = 2;
  int64 bid_qty_e8 = 3;
  int64 ask_px_e8 = 4;
  int64 ask_qty_e8 = 5;
}

message BookSnapshot {
  EventMeta meta = 1;
  InstrumentRef instrument = 2;
  repeated BookLevel levels = 3;
  uint32 depth = 4;
}

message BookDeltaEntry {
  DeltaAction action = 1;
  Side side = 2;          // SIDE_BUY => bid side, SIDE_SELL => ask side
  uint32 level = 3;
  int64 px_e8 = 4;
  int64 qty_e8 = 5;
}

message BookDelta {
  EventMeta meta = 1;
  InstrumentRef instrument = 2;
  repeated BookDeltaEntry entries = 3;
}

message MarketDataEvent {
  oneof payload {
    TopOfBook top_of_book = 1;
    TradePrint trade_print = 2;
    Bar bar = 3;
    BookSnapshot book_snapshot = 4;
    BookDelta book_delta = 5;
  }
}
